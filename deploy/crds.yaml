apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: proxykubeapis.weebo.si.rs
spec:
  group: weebo.si.rs
  names:
    categories: []
    kind: ProxyKubeApi
    plural: proxykubeapis
    shortNames: []
    singular: proxykubeapi
  scope: Namespaced
  versions:
  - additionalPrinterColumns: []
    name: v1
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for ProxyKubeApiSpec via `CustomResource`
        properties:
          spec:
            properties:
              auth_config:
                description: Main configuration for authentication
                nullable: true
                properties:
                  jwt:
                    default: []
                    items:
                      properties:
                        claim_mappings:
                          properties:
                            extra:
                              items:
                                properties:
                                  key:
                                    type: string
                                  value_expression:
                                    type: string
                                required:
                                - key
                                - value_expression
                                type: object
                              type: array
                            groups:
                              nullable: true
                              properties:
                                claim:
                                  type: string
                                expression:
                                  type: string
                                prefix:
                                  nullable: true
                                  type: string
                              required:
                              - claim
                              - expression
                              type: object
                            uid:
                              nullable: true
                              properties:
                                claim:
                                  nullable: true
                                  type: string
                                expression:
                                  nullable: true
                                  type: string
                              type: object
                            username:
                              nullable: true
                              properties:
                                claim:
                                  type: string
                                expression:
                                  type: string
                                prefix:
                                  nullable: true
                                  type: string
                              required:
                              - claim
                              - expression
                              type: object
                          required:
                          - extra
                          type: object
                        claim_validation_rules:
                          items:
                            properties:
                              claim:
                                type: string
                              expression:
                                type: string
                              message:
                                type: string
                              required_value:
                                type: string
                            required:
                            - claim
                            - expression
                            - message
                            - required_value
                            type: object
                          type: array
                        issuer:
                          properties:
                            audience_match_policy:
                              enum:
                              - MatchAny
                              type: string
                            audiences:
                              items:
                                type: string
                              type: array
                            certificate_authority:
                              nullable: true
                              type: string
                            discovery_url:
                              nullable: true
                              type: string
                            egress_selector:
                              enum:
                              - controlplane
                              - cluster
                              type: string
                            url:
                              type: string
                          required:
                          - audience_match_policy
                          - audiences
                          - egress_selector
                          - url
                          type: object
                        user_validation_rules:
                          items:
                            properties:
                              expression:
                                type: string
                              message:
                                type: string
                            required:
                            - expression
                            - message
                            type: object
                          type: array
                      required:
                      - claim_mappings
                      - claim_validation_rules
                      - issuer
                      - user_validation_rules
                      type: object
                    type: array
                  oidc_provider:
                    properties:
                      client_id:
                        type: string
                      client_secret:
                        nullable: true
                        type: string
                      enabled:
                        default: false
                        type: boolean
                      extra_scope:
                        default: ''
                        type: string
                      issuer_url:
                        type: string
                    required:
                    - client_id
                    - issuer_url
                    type: object
                  validate_against:
                    default: Kubernetes
                    description: |-
                      Validate against the configured JWT authenticators, OIDC provider or Kubernetes API
                      Default : OidcProvider if enabled, otherwise JwtAuthenticators if configured, otherwise Kubernetes
                    enum:
                    - OidcProvider
                    - Kubernetes
                    type: string
                required:
                - oidc_provider
                type: object
              cert:
                description: Certificate for the Kubernetes API
                oneOf:
                - required:
                  - Secret
                - required:
                  - Cert
                - required:
                  - ConfigMap
                - required:
                  - Insecure
                properties:
                  Cert:
                    description: Base64 encoded cert
                    type: string
                  ConfigMap:
                    description: Configmap
                    properties:
                      key:
                        type: string
                      name:
                        type: string
                      namespace:
                        nullable: true
                        type: string
                    required:
                    - key
                    - name
                    type: object
                  Insecure:
                    description: Insecure, do not use TLS
                    type: boolean
                  Secret:
                    description: Use a cert from a secret
                    properties:
                      key:
                        type: string
                      name:
                        type: string
                      namespace:
                        nullable: true
                        type: string
                    required:
                    - key
                    - name
                    type: object
                type: object
              dashboard_group:
                description: |-
                  If the proxy exposition is accessible via the dashboard
                  the oidc group that allow access to the dashboard, should be unique
                  Default: to the resource namespace + resource name
                nullable: true
                type: string
              enabled:
                default: true
                description: Enable or disable the proxy
                type: boolean
              expose_via_dashboard:
                default: true
                description: |-
                  If the proxy exposition should be accessible via the Dashboard
                  Default: false
                type: boolean
              security_config:
                description: Security configuration
                nullable: true
                properties:
                  allowed_ressources:
                    description: Allowed resources, limit the access to the proxy to only these resources, if empty all resources are allowed
                    items:
                      description: Enum of the allowed paths configuration, currently only supports path and crd, but can be extended in the future
                      oneOf:
                      - required:
                        - Path
                      properties:
                        Path:
                          description: Allowed path configuration, used in conjunction with the allowed_paths configuration
                          properties:
                            parametised:
                              default: false
                              description: |-
                                Wether or not the path is parametised
                                if true, the path will be treated as a template, it either handle wildcard parameters, like "*" or "dev-*", or mustache-like parameters, like "{{username}}" or "{{group}}"
                                for example, if the path is "/api/v1/namespaces/*/pods", it will allow all requests to pods in any namespace
                                if the path is "/api/v1/namespaces/dev-*/pods", it will allow all requests to pods in namespaces that start with "dev-"
                                It will also try to detect mustache-like parameters, for example, if the path is "/api/v1/namespaces/{{username}}/pods"
                                it will allow all requests to pods in namespaces carrying the username as a parameter
                                if the selected field is an array, like the groups claim, it will try to match any of the values in the array
                                for example, if the groups claim is ["dev-alice", "dev-bob"] and the path is "/api/v1/namespaces/{{group}}/pods", it will allow all requests to pods in namespaces that match either "dev-alice" or "dev-bob"
                                Allowed parameters are : {{username}} and {{group}}
                                default: false
                              type: boolean
                            path:
                              description: The path to allow, if the request path equals this path, it will be allowed
                              type: string
                          required:
                          - path
                          type: object
                      type: object
                    type: array
                  enabled:
                    default: true
                    description: Whether the token is validated beforehand
                    type: boolean
                required:
                - allowed_ressources
                type: object
              service:
                description: Service to expose the proxy
                oneOf:
                - required:
                  - KubernetesService
                - required:
                  - ExternalService
                properties:
                  ExternalService:
                    description: External service
                    properties:
                      url:
                        description: URL of the external service (e.g. https://example.com)
                        type: string
                    required:
                    - url
                    type: object
                  KubernetesService:
                    description: Kubernetes service
                    properties:
                      name:
                        description: Name of the service
                        type: string
                      namespace:
                        description: If not set, will use the resource namespace
                        nullable: true
                        type: string
                      port:
                        description: Port of the service
                        format: uint16
                        maximum: 65535.0
                        minimum: 0.0
                        nullable: true
                        type: integer
                      port_name:
                        description: Port name of the service
                        nullable: true
                        type: string
                    required:
                    - name
                    type: object
                type: object
            required:
            - cert
            - service
            type: object
          status:
            nullable: true
            properties:
              error:
                nullable: true
                type: string
              exposed:
                type: boolean
              path:
                nullable: true
                type: string
            required:
            - exposed
            type: object
        required:
        - spec
        title: ProxyKubeApi
        type: object
    served: true
    storage: true
    subresources:
      status: {}
