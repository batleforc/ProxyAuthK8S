name: ðŸ”„ Update Release Reports

on:
  push:
    branches:
      - "NR/release-*" # Se dÃ©clenche sur toutes les branches de release
  workflow_dispatch:
    inputs:
      branch_name:
        description: "Nom de la branche release Ã  mettre Ã  jour"
        required: true
        type: string

# ðŸ“Š Ce workflow met Ã  jour automatiquement les rapports de release
# quand des changements sont poussÃ©s sur une branche de release
env:
  REGISTRY: ghcr.io
  REPO_NAME_LOWER: ${{ format('{0}', github.event.repository.name) }}
  IMAGE_NAME_SERVER: ${{ github.repository_owner }}/proxyauthk8s/server
  IMAGE_NAME_FRONT: ${{ github.repository_owner }}/proxyauthk8s/front
  NODE_VERSION: "24"
  RUST_VERSION: "1.91"

jobs:
  detect-release-info:
    name: ðŸ” DÃ©tection des Infos de Release
    runs-on: ubuntu-latest
    outputs:
      branch_name: ${{ steps.branch_info.outputs.branch_name }}
      version: ${{ steps.branch_info.outputs.version }}
      is_release_branch: ${{ steps.branch_info.outputs.is_release_branch }}
    steps:
      - name: ðŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ðŸ” Analyser la Branche
        id: branch_info
        run: |
          # DÃ©terminer le nom de la branche
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            BRANCH_NAME="${{ github.event.inputs.branch_name }}"
          else
            BRANCH_NAME="${{ github.ref_name }}"
          fi

          echo "branch_name=$BRANCH_NAME" >> $GITHUB_OUTPUT
          echo "ðŸ” Branche analysÃ©e: $BRANCH_NAME"

          # VÃ©rifier si c'est une branche de release
          if [[ "$BRANCH_NAME" =~ ^NR/release-v.*$ ]]; then
            echo "is_release_branch=true" >> $GITHUB_OUTPUT

            # Extraire la version depuis le nom de branche
            VERSION=$(echo "$BRANCH_NAME" | sed 's/^NR\/release-v//')
            echo "version=$VERSION" >> $GITHUB_OUTPUT
            echo "ðŸ“‹ Version dÃ©tectÃ©e: $VERSION"
          else
            echo "is_release_branch=false" >> $GITHUB_OUTPUT
            echo "âš ï¸ Cette branche n'est pas une branche de release"
          fi

  update-quality-reports:
    name: ðŸ” Mise Ã  Jour des Rapports de QualitÃ©
    runs-on: ubuntu-latest
    needs: detect-release-info
    if: needs.detect-release-info.outputs.is_release_branch == 'true'
    outputs:
      backend_quality: ${{ steps.backend_check.outputs.status }}
      frontend_quality: ${{ steps.frontend_check.outputs.status }}
    steps:
      - name: ðŸ“¥ Checkout Release Branch
        uses: actions/checkout@v4
        with:
          ref: ${{ needs.detect-release-info.outputs.branch_name }}
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: "npm"
          cache-dependency-path: package-lock.json

      - name: ðŸ¦€ Setup Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          toolchain: ${{ env.RUST_VERSION }}
          components: clippy, rustfmt

      - name: ðŸ”§ Install Dependencies
        run: |
          yarn install --frozen-lockfile
        env:
          NODE_ENV: production

      - name: ðŸ” Backend Quality Check
        id: backend_check
        run: |
          echo "## ðŸ¦€ Backend Quality Report (Updated)" > quality_report.md
          echo "**Branch:** \`${{ needs.detect-release-info.outputs.branch_name }}\`" >> quality_report.md
          echo "**Version:** \`v${{ needs.detect-release-info.outputs.version }}\`" >> quality_report.md
          echo "**Updated:** \`$(date -u '+%Y-%m-%d %H:%M:%S UTC')\`" >> quality_report.md
          echo "" >> quality_report.md

          # Rust formatting check
          if cargo fmt -- --check; then
            echo "âœ… Rust code formatting is correct" >> quality_report.md
          else
            echo "âŒ Rust code formatting issues found" >> quality_report.md
            echo "status=failed" >> $GITHUB_OUTPUT
            exit 1
          fi

          # Rust clippy check
          if cargo clippy --all-targets --all-features -- -D warnings; then
            echo "âœ… Rust clippy checks passed" >> quality_report.md
          else
            echo "âŒ Rust clippy issues found" >> quality_report.md
            echo "status=failed" >> $GITHUB_OUTPUT
            exit 1
          fi

          # Rust tests
          if cargo test; then
            echo "âœ… Rust tests passed" >> quality_report.md
          else
            echo "âŒ Rust tests failed" >> quality_report.md
            echo "status=failed" >> $GITHUB_OUTPUT
            exit 1
          fi

          echo "status=success" >> $GITHUB_OUTPUT

      - name: ðŸ” Frontend Quality Check
        id: frontend_check
        run: |
          echo "" >> quality_report.md
          echo "## ðŸŒ Frontend Quality Report (Updated)" >> quality_report.md
          yarn install

          # TypeScript compilation
          if yarn build; then
            echo "âœ… TypeScript compilation successful" >> quality_report.md
          else
            echo "âŒ TypeScript compilation failed" >> quality_report.md
            echo "status=failed" >> $GITHUB_OUTPUT
            exit 1
          fi

          # Linting
          if yarn nx lint front; then
            echo "âœ… Frontend linting passed" >> quality_report.md
          else
            echo "âŒ Frontend linting issues found" >> quality_report.md
            echo "status=failed" >> $GITHUB_OUTPUT
            exit 1
          fi

          echo "status=success" >> $GITHUB_OUTPUT

      - name: ðŸ“¤ Upload Updated Quality Report
        uses: actions/upload-artifact@v4
        with:
          name: updated-quality-report
          path: quality_report.md

  update-security-audit:
    name: ðŸ”’ Mise Ã  Jour de l'Audit de SÃ©curitÃ©
    runs-on: ubuntu-latest
    needs: detect-release-info
    if: needs.detect-release-info.outputs.is_release_branch == 'true'
    outputs:
      audit_status: ${{ steps.audit.outputs.status }}
    steps:
      - name: ðŸ“¥ Checkout Release Branch
        uses: actions/checkout@v4
        with:
          ref: ${{ needs.detect-release-info.outputs.branch_name }}

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: "npm"

      - name: ðŸ¦€ Setup Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          toolchain: ${{ env.RUST_VERSION }}

      - name: ðŸ”§ Install Audit Tools
        run: |
          npm install -g npm-audit-resolver
          cargo install cargo-audit

      - name: ðŸ” Security Audit
        id: audit
        run: |
          echo "## ðŸ”’ Security Audit Report (Updated)" > security_report.md
          echo "**Branch:** \`${{ needs.detect-release-info.outputs.branch_name }}\`" >> security_report.md
          echo "**Version:** \`v${{ needs.detect-release-info.outputs.version }}\`" >> security_report.md
          echo "**Updated:** \`$(date -u '+%Y-%m-%d %H:%M:%S UTC')\`" >> security_report.md
          echo "" >> security_report.md

          # NPM Audit
          echo "### ðŸ“¦ NPM Dependencies" >> security_report.md
          if npm audit --audit-level=moderate; then
            echo "âœ… No moderate or high severity vulnerabilities found in NPM packages" >> security_report.md
          else
            echo "âŒ Security vulnerabilities found in NPM packages" >> security_report.md
            npm audit --json >> security_report.md
            echo "status=failed" >> $GITHUB_OUTPUT
            exit 1
          fi

          # Cargo Audit with severity filtering
          echo "" >> security_report.md
          echo "### ðŸ¦€ Rust Dependencies" >> security_report.md

          if cargo audit --format json > cargo_audit_output.json 2>/dev/null; then
            echo "âœ… No security vulnerabilities found in Rust packages" >> security_report.md
          else
            # Parse JSON output to filter by severity > 7
            high_severity_count=$(jq -r '
              [.vulnerabilities.list[] |
               select(.advisory.cvss and (.advisory.cvss | tonumber) > 7.0)] |
              length' cargo_audit_output.json 2>/dev/null || echo "0")

            total_vulns=$(jq -r '.vulnerabilities.count // 0' cargo_audit_output.json 2>/dev/null || echo "0")

            echo "Found $total_vulns total vulnerabilities, $high_severity_count with severity > 7.0" >> security_report.md
            echo "" >> security_report.md

            # Add detailed vulnerability report
            echo "#### ðŸ” Vulnerability Details" >> security_report.md
            jq -r '.vulnerabilities.list[] |
              "- **\(.advisory.id)**: \(.advisory.title) (CVSS: \(.advisory.cvss // "N/A"))" +
              "\n  - Package: \(.package.name) v\(.package.version)" +
              "\n  - Severity: \(if .advisory.cvss and (.advisory.cvss | tonumber) > 7.0 then "ðŸ”´ HIGH" else "ðŸŸ¡ LOW/MEDIUM" end)" +
              "\n"' cargo_audit_output.json >> security_report.md 2>/dev/null || echo "- Error parsing vulnerability details" >> security_report.md

            # Only fail if high severity vulnerabilities found
            if [ "$high_severity_count" -gt 0 ]; then
              echo "âŒ $high_severity_count high-severity vulnerabilities (CVSS > 7.0) found in Rust packages" >> security_report.md
              echo "status=failed" >> $GITHUB_OUTPUT
              exit 1
            else
              echo "âœ… No high-severity vulnerabilities (CVSS > 7.0) found, but $total_vulns lower-severity issues exist" >> security_report.md
            fi
          fi

          echo "status=success" >> $GITHUB_OUTPUT

      - name: ðŸ“¤ Upload Updated Security Report
        uses: actions/upload-artifact@v4
        with:
          name: updated-security-report
          path: security_report.md

  validate-commits:
    name: âœ… Validation des Commits
    runs-on: ubuntu-latest
    needs: detect-release-info
    if: needs.detect-release-info.outputs.is_release_branch == 'true'
    outputs:
      commit_status: ${{ steps.validate.outputs.status }}
    steps:
      - name: ðŸ“¥ Checkout Release Branch
        uses: actions/checkout@v4
        with:
          ref: ${{ needs.detect-release-info.outputs.branch_name }}
          fetch-depth: 0

      - name: ðŸ¦€ Setup Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          toolchain: ${{ env.RUST_VERSION }}

      - name: ðŸ”§ Install Cocogitto
        run: |
          cargo install --locked cocogitto

      - name: âœ… Validate Commits
        id: validate
        run: |
          echo "## âœ… Commit Validation Report (Updated)" > commit_report.md
          echo "**Branch:** \`${{ needs.detect-release-info.outputs.branch_name }}\`" >> commit_report.md
          echo "**Version:** \`v${{ needs.detect-release-info.outputs.version }}\`" >> commit_report.md
          echo "**Updated:** \`$(date -u '+%Y-%m-%d %H:%M:%S UTC')\`" >> commit_report.md
          echo "" >> commit_report.md

          echo "### ðŸ“ Cocogitto Conventional Commit Validation" >> commit_report.md
          failed=false

          # Check if any tags exist
          if git tag -l | grep -q .; then
            echo "Tags found, checking commits from latest tag..."
            cog_command="cog check --from-latest-tag"
          else
            echo "No tags found, checking all commits..."
            cog_command="cog check"
          fi

          # Run cog check to validate commits
          if $cog_command 2>&1 | tee cog_output.txt; then
            echo "âœ… All commits follow conventional commit format" >> commit_report.md
            echo "" >> commit_report.md
            echo "Command used: \`$cog_command\`" >> commit_report.md
            echo "" >> commit_report.md
            echo "\`\`\`" >> commit_report.md
            cat cog_output.txt >> commit_report.md
            echo "\`\`\`" >> commit_report.md
          else
            echo "âŒ Some commits don't follow conventional commit format" >> commit_report.md
            echo "" >> commit_report.md
            echo "Command used: \`$cog_command\`" >> commit_report.md
            echo "" >> commit_report.md
            echo "\`\`\`" >> commit_report.md
            cat cog_output.txt >> commit_report.md
            echo "\`\`\`" >> commit_report.md
            failed=true
          fi

          if [ "$failed" = true ]; then
            echo "status=failed" >> $GITHUB_OUTPUT
            exit 1
          else
            echo "status=success" >> $GITHUB_OUTPUT
          fi

      - name: ðŸ“¤ Upload Updated Commit Report
        uses: actions/upload-artifact@v4
        with:
          name: updated-commit-report
          path: commit_report.md

  rebuild-docker-images:
    name: ðŸ³ Rebuild Docker Images
    runs-on: ubuntu-latest
    needs: detect-release-info
    if: needs.detect-release-info.outputs.is_release_branch == 'true'
    outputs:
      server_image: ${{ steps.build_server.outputs.image }}
      front_image: ${{ steps.build_front.outputs.image }}
      build_status: ${{ steps.build_status.outputs.status }}
    steps:
      - name: ðŸ“¥ Checkout Release Branch
        uses: actions/checkout@v4
        with:
          ref: ${{ needs.detect-release-info.outputs.branch_name }}
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ðŸ”§ Setup Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: ðŸ” Login to Container Registry
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: ðŸ”§ Install Syft for SBOM generation
        run: |
          curl -sSfL https://raw.githubusercontent.com/anchore/syft/main/install.sh | sh -s -- -b /usr/local/bin

      - name: ðŸ—ï¸ Build Server Image
        id: build_server
        run: |
          IMAGE_TAG="${{ env.REGISTRY }}/${{ env.IMAGE_NAME_SERVER }}:v${{ needs.detect-release-info.outputs.version }}"

          echo "ðŸ—ï¸ Building server image: $IMAGE_TAG"

          docker buildx build \
            --platform linux/amd64 \
            --tag $IMAGE_TAG \
            --tag ${{ env.REGISTRY }}/${{ env.IMAGE_NAME_SERVER }}:latest \
            --file deploy/build/back/Containerfile \
            --push .

          echo "image=$IMAGE_TAG" >> $GITHUB_OUTPUT
          echo "âœ… Server image built and pushed: $IMAGE_TAG"

      - name: ðŸ—ï¸ Build Front Image
        id: build_front
        run: |
          IMAGE_TAG="${{ env.REGISTRY }}/${{ env.IMAGE_NAME_FRONT }}:v${{ needs.detect-release-info.outputs.version }}"

          echo "ðŸ—ï¸ Building frontend image: $IMAGE_TAG"

          docker buildx build \
            --platform linux/amd64 \
            --tag $IMAGE_TAG \
            --tag ${{ env.REGISTRY }}/${{ env.IMAGE_NAME_FRONT }}:latest \
            --file deploy/build/front/Containerfile \
            --push .

          echo "image=$IMAGE_TAG" >> $GITHUB_OUTPUT
          echo "âœ… Frontend image built and pushed: $IMAGE_TAG"

      - name: ðŸ“‹ Generate Updated SBOM for Server
        run: |
          echo "ðŸ“‹ Generating SBOM for server image..."
          syft ${{ steps.build_server.outputs.image }} -o spdx-json=server-sbom-updated.json
          syft ${{ steps.build_server.outputs.image }} -o table=server-sbom-updated.txt

      - name: ðŸ“‹ Generate Updated SBOM for Front
        run: |
          echo "ðŸ“‹ Generating SBOM for frontend image..."
          syft ${{ steps.build_front.outputs.image }} -o spdx-json=front-sbom-updated.json
          syft ${{ steps.build_front.outputs.image }} -o table=front-sbom-updated.txt

      - name: ðŸ” Quick Vulnerability Scan
        run: |
          echo "ðŸ” Running quick vulnerability scan..."
          curl -sSfL https://raw.githubusercontent.com/anchore/grype/main/install.sh | sh -s -- -b /usr/local/bin

          echo "## ðŸ³ Docker Images Rebuild Report" > docker_rebuild_report.md
          echo "**Branch:** \`${{ needs.detect-release-info.outputs.branch_name }}\`" >> docker_rebuild_report.md
          echo "**Version:** \`v${{ needs.detect-release-info.outputs.version }}\`" >> docker_rebuild_report.md
          echo "**Updated:** \`$(date -u '+%Y-%m-%d %H:%M:%S UTC')\`" >> docker_rebuild_report.md
          echo "" >> docker_rebuild_report.md

          echo "### ðŸ—ï¸ Built Images" >> docker_rebuild_report.md
          echo "- ðŸ–¥ï¸ **Server:** \`${{ steps.build_server.outputs.image }}\`" >> docker_rebuild_report.md
          echo "- ðŸŒ **Frontend:** \`${{ steps.build_front.outputs.image }}\`" >> docker_rebuild_report.md
          echo "" >> docker_rebuild_report.md

          echo "### ðŸ” Vulnerability Summary" >> docker_rebuild_report.md
          echo "#### Server Image" >> docker_rebuild_report.md
          grype ${{ steps.build_server.outputs.image }} -o table --only-fixed >> docker_rebuild_report.md || echo "No vulnerabilities found or scan failed" >> docker_rebuild_report.md

          echo "" >> docker_rebuild_report.md
          echo "#### Frontend Image" >> docker_rebuild_report.md
          grype ${{ steps.build_front.outputs.image }} -o table --only-fixed >> docker_rebuild_report.md || echo "No vulnerabilities found or scan failed" >> docker_rebuild_report.md

      - name: âœ… Set Build Status
        id: build_status
        run: |
          echo "status=success" >> $GITHUB_OUTPUT
          echo "âœ… Docker images rebuild completed successfully"

      - name: ðŸ“¤ Upload Docker Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: updated-docker-artifacts
          path: |
            *-sbom-updated.json
            *-sbom-updated.txt
            docker_rebuild_report.md

  update-pr-comment:
    name: ðŸ’¬ Mise Ã  Jour du Commentaire PR
    runs-on: ubuntu-latest
    needs:
      - detect-release-info
      - update-quality-reports
      - update-security-audit
      - validate-commits
      - rebuild-docker-images
    if: always() && needs.detect-release-info.outputs.is_release_branch == 'true'
    steps:
      - name: ðŸ“¥ Download Updated Reports
        uses: actions/download-artifact@v4

      - name: ðŸ’¬ Update PR Comment
        uses: actions/github-script@v7
        with:
          script: |
            const branchName = "${{ needs.detect-release-info.outputs.branch_name }}";
            const version = "${{ needs.detect-release-info.outputs.version }}";

            // Find PR for this release branch
            const { data: prs } = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              head: `${context.repo.owner}:${branchName}`,
              state: 'open'
            });

            if (prs.length === 0) {
              console.log('No open PR found for this branch');
              return;
            }

            const pr = prs[0];
            const timestamp = new Date().toISOString();

            // Create updated status report
            let commentBody = `## ðŸ”„ Release Reports Updated\n\n`;
            commentBody += `**Version:** \`v${version}\`\n`;
            commentBody += `**Branch:** \`${branchName}\`\n`;
            commentBody += `**Last Updated:** \`${timestamp}\`\n\n`;

            commentBody += `### ðŸ“Š Status Summary\n\n`;
            commentBody += `| Check | Status | Last Run |\n`;
            commentBody += `|-------|--------|----------|\n`;

            const backendStatus = "${{ needs.update-quality-reports.outputs.backend_quality }}";
            const frontendStatus = "${{ needs.update-quality-reports.outputs.frontend_quality }}";
            const securityStatus = "${{ needs.update-security-audit.outputs.audit_status }}";
            const commitStatus = "${{ needs.validate-commits.outputs.commit_status }}";
            const dockerStatus = "${{ needs.rebuild-docker-images.outputs.build_status }}";

            commentBody += `| ðŸ¦€ Backend Quality | ${backendStatus === 'success' ? 'âœ… Passed' : 'âŒ Failed'} | ${timestamp} |\n`;
            commentBody += `| ðŸŒ Frontend Quality | ${frontendStatus === 'success' ? 'âœ… Passed' : 'âŒ Failed'} | ${timestamp} |\n`;
            commentBody += `| ðŸ”’ Security Audit | ${securityStatus === 'success' ? 'âœ… Passed' : 'âŒ Failed'} | ${timestamp} |\n`;
            commentBody += `| âœ… Commit Validation | ${commitStatus === 'success' ? 'âœ… Passed' : 'âŒ Failed'} | ${timestamp} |\n`;
            commentBody += `| ðŸ³ Docker Rebuild | ${dockerStatus === 'success' ? 'âœ… Completed' : 'âŒ Failed'} | ${timestamp} |\n`;

            // Add Docker images info if build was successful
            if (dockerStatus === 'success') {
              const serverImage = "${{ needs.rebuild-docker-images.outputs.server_image }}";
              const frontImage = "${{ needs.rebuild-docker-images.outputs.front_image }}";

              commentBody += `\n### ðŸ³ Updated Docker Images\n`;
              commentBody += `- ðŸ–¥ï¸ **Server:** \`${serverImage}\`\n`;
              commentBody += `- ðŸŒ **Frontend:** \`${frontImage}\`\n`;
            }

            commentBody += `\n*Reports are automatically updated when changes are pushed to this release branch.*\n`;

            // Check for existing update comments
            const { data: comments } = await github.rest.issues.listComments({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pr.number
            });

            const existingComment = comments.find(comment =>
              comment.body.includes('ðŸ”„ Release Reports Updated') &&
              comment.user.type === 'Bot'
            );

            if (existingComment) {
              // Update existing comment
              await github.rest.issues.updateComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                comment_id: existingComment.id,
                body: commentBody
              });
              console.log(`Updated existing comment ${existingComment.id}`);
            } else {
              // Create new comment
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: pr.number,
                body: commentBody
              });
              console.log('Created new update comment');
            }

  summary:
    name: ðŸ“Š RÃ©sumÃ© de la Mise Ã  Jour
    runs-on: ubuntu-latest
    needs:
      - detect-release-info
      - update-quality-reports
      - update-security-audit
      - validate-commits
      - rebuild-docker-images
    if: always()
    steps:
      - name: ðŸ“Š Generate Summary
        run: |
          echo "## ðŸ”„ Release Reports Update Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          if [ "${{ needs.detect-release-info.outputs.is_release_branch }}" != "true" ]; then
            echo "âš ï¸ **Not a release branch**" >> $GITHUB_STEP_SUMMARY
            echo "- Branch: \`${{ needs.detect-release-info.outputs.branch_name }}\`" >> $GITHUB_STEP_SUMMARY
            echo "- Only branches matching \`NR/release-*\` pattern are processed" >> $GITHUB_STEP_SUMMARY
          else
            echo "ðŸŽ¯ **Release Branch Detected**" >> $GITHUB_STEP_SUMMARY
            echo "- **Branch:** \`${{ needs.detect-release-info.outputs.branch_name }}\`" >> $GITHUB_STEP_SUMMARY
            echo "- **Version:** \`v${{ needs.detect-release-info.outputs.version }}\`" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY

            echo "### ðŸ“Š Updated Reports Status" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "| Report | Status |" >> $GITHUB_STEP_SUMMARY
            echo "|--------|--------|" >> $GITHUB_STEP_SUMMARY

            backend_status="${{ needs.update-quality-reports.outputs.backend_quality }}"
            frontend_status="${{ needs.update-quality-reports.outputs.frontend_quality }}"
            security_status="${{ needs.update-security-audit.outputs.audit_status }}"
            commit_status="${{ needs.validate-commits.outputs.commit_status }}"
            docker_status="${{ needs.rebuild-docker-images.outputs.build_status }}"

            echo "| ðŸ¦€ Backend Quality | ${backend_status:-'âš ï¸ Skipped'} |" >> $GITHUB_STEP_SUMMARY
            echo "| ðŸŒ Frontend Quality | ${frontend_status:-'âš ï¸ Skipped'} |" >> $GITHUB_STEP_SUMMARY
            echo "| ðŸ”’ Security Audit | ${security_status:-'âš ï¸ Skipped'} |" >> $GITHUB_STEP_SUMMARY
            echo "| âœ… Commit Validation | ${commit_status:-'âš ï¸ Skipped'} |" >> $GITHUB_STEP_SUMMARY
            echo "| ðŸ³ Docker Rebuild | ${docker_status:-'âš ï¸ Skipped'} |" >> $GITHUB_STEP_SUMMARY

            # Add Docker images info if build was successful
            if [ "$docker_status" = "success" ]; then
              echo "" >> $GITHUB_STEP_SUMMARY
              echo "### ðŸ³ Rebuilt Docker Images" >> $GITHUB_STEP_SUMMARY
              echo "- ðŸ–¥ï¸ **Server:** \`${{ needs.rebuild-docker-images.outputs.server_image }}\`" >> $GITHUB_STEP_SUMMARY
              echo "- ðŸŒ **Frontend:** \`${{ needs.rebuild-docker-images.outputs.front_image }}\`" >> $GITHUB_STEP_SUMMARY
            fi
          fi

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "*Auto-triggered on: $(date -u '+%Y-%m-%d %H:%M:%S UTC')*" >> $GITHUB_STEP_SUMMARY
